{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport { markupGallery } from './render-functions';\nimport axios from 'axios';\n\nexport const fetchImages = async (request, page) => {\n  const API_URL = 'https://pixabay.com/api/';\n  const API_KEY = '42512017-1bddfdd3afd2851258a10c68c';\n  const QUESTION = request;\n  await axios\n    .get(`${API_URL}?key=${API_KEY}&q=${QUESTION}`, {\n      params: {\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: 'true',\n        page: page,\n        per_page: 15,\n      },\n    })\n    .then(response => {\n      markupGallery(response.data, request, page);\n    })\n    .catch(error =>\n      iziToast.error({\n        class: 'popup-message',\n        theme: 'dark',\n        backgroundColor: '#ef4040',\n        messageColor: '#fff',\n        iconUrl: Error,\n        position: 'topRight',\n        pauseOnHover: true,\n        timeout: 3000,\n        message: `${error}`,\n      })\n    );\n};\n","import { fetchImages } from './pixabay-api';\nimport SimpleLightbox from 'simplelightbox';\nimport iziToast from 'izitoast';\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  spinner: false,\n  overlayOpacity: 0.8,\n});\n\nconst windowScrollHandler = () => {\n  const itemHeight = document\n    .querySelector('.gallery__list')\n    .firstElementChild.getBoundingClientRect().height;\n\n  window.scrollBy({\n    top: itemHeight * 2 + 48,\n    left: 0,\n    behavior: 'smooth',\n  });\n};\n\nconst initPaginationHandler = (state, request, page) => {\n  const parent = document.querySelector('.gallery');\n\n  if (state) {\n    parent.insertAdjacentHTML(\n      'beforeend',\n      '<button class=\"gallery__action\" type=\"button\">Load more</button>'\n    );\n\n    const trigger = parent.querySelector('.gallery__action');\n\n    trigger.addEventListener('click', () => {\n      page += 1;\n      trigger.remove();\n      toggleLoader(true);\n      setTimeout(async () => {\n        await fetchImages(request, page);\n        windowScrollHandler();\n      }, 500);\n    });\n  } else {\n    const trigger = parent.querySelector('.gallery__action');\n\n    if (!trigger) {\n      return;\n    }\n\n    trigger.remove();\n  }\n};\n\nconst initGalleryItems = (total, request, page) => {\n  const items = [...document.querySelectorAll('.gallery__item')];\n  const trigger = document.querySelector('.gallery__action');\n  const parent = document.querySelector('.gallery');\n\n  if (!items.length || trigger) {\n    return;\n  }\n\n  if (items.length < total) {\n    initPaginationHandler(true, request, page);\n  } else {\n    initPaginationHandler(false);\n    parent.insertAdjacentHTML(\n      'beforeend',\n      `<p class=\"gallery__meassage\">We're sorry, but you've reached the end of search results.</p>`\n    );\n  }\n};\n\nconst toggleLoader = state => {\n  const parent = document.querySelector('.gallery');\n\n  if (state) {\n    parent.insertAdjacentHTML('beforeend', '<div class=\"loader\"></div>');\n  } else {\n    const loader = parent.querySelector('.loader');\n\n    if (!loader) {\n      return;\n    }\n\n    loader.remove();\n  }\n};\n\nconst clearGallery = () => {\n  const gallery = document.querySelector('.gallery__list');\n\n  if (!gallery) {\n    return;\n  }\n\n  gallery.innerHTML = '';\n\n  const message = document.querySelector('.gallery__meassage');\n\n  if (!message) {\n    return;\n  }\n\n  message.remove();\n};\n\nexport const markupGallery = ({ hits, totalHits }, request, page) => {\n  const gallery = document.querySelector('.gallery__list');\n\n  if (!gallery) {\n    return;\n  }\n\n  if (!hits.length) {\n    iziToast.error({\n      class: 'popup-message',\n      theme: 'dark',\n      backgroundColor: '#ef4040',\n      messageColor: '#fff',\n      iconUrl: Error,\n      position: 'topRight',\n      pauseOnHover: true,\n      timeout: 3000,\n      message: `Sorry, there are no images matching your search query. Please, try again!`,\n    });\n\n    toggleLoader(false);\n  }\n\n  const galleryItems = [];\n\n  hits.map(item => {\n    const markup = `<li class=\"gallery__item\">\n      <div class=\"gallery-card\">\n        <a class=\"gallery-card__link\" href=\"${item.largeImageURL}\" aria-label=\"Open image in modal\">\n          <img class=\"gallery-card__image\" src=\"${item.webformatURL}\" alt=\"${item.tags}\">\n        </a>\n        <div class=\"gallery-card__caption\">\n          <p class=\"gallery-card__text\">Likes <span>${item.likes}</span></p>\n          <p class=\"gallery-card__text\">Views <span>${item.views}</span></p>\n          <p class=\"gallery-card__text\">Comments <span>${item.comments}</span></p>\n          <p class=\"gallery-card__text\">Downloads <span>${item.downloads}</span></p>\n        </div>\n      </div>\n    </li>`;\n\n    galleryItems.push(markup);\n  });\n\n  toggleLoader(false);\n  gallery.insertAdjacentHTML('beforeend', galleryItems.join(''));\n  lightbox.refresh();\n  initGalleryItems(totalHits, request, page);\n};\n\nexport const initForm = () => {\n  const form = document.querySelector('.form');\n  const input = form.querySelector('.form__input');\n\n  if (!form || !input) {\n    return;\n  }\n\n  form.addEventListener('submit', e => {\n    e.preventDefault();\n\n    if (!input.value.length) {\n      return;\n    }\n\n    const request = input.value.trim().split(' ').join('+');\n\n    clearGallery();\n    toggleLoader(true);\n    initPaginationHandler(false, request);\n\n    setTimeout(() => {\n      fetchImages(request, 1);\n    }, 500);\n\n    input.value = '';\n  });\n};\n","'use strict';\n\nimport { initForm } from './js/render-functions';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  initForm();\n});\n"],"names":["fetchImages","request","page","API_URL","API_KEY","QUESTION","axios","response","markupGallery","error","iziToast","lightbox","SimpleLightbox","windowScrollHandler","itemHeight","initPaginationHandler","state","parent","trigger","toggleLoader","initGalleryItems","total","items","loader","clearGallery","gallery","message","hits","totalHits","galleryItems","item","markup","initForm","form","input","e"],"mappings":"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"}